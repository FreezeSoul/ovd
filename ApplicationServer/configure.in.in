m4_define([uovdas_version_major], [1])
m4_define([uovdas_version_minor], [0])
#m4_define([uovdas_version_build], [~svn@REVISION@])
m4_define([uovdas_version_build], [~rc1])
m4_define([uovdas_version], [uovdas_version_major().uovdas_version_minor()uovdas_version_build()])

AC_INIT([ovd-application-server], [uovdas_version], [http://bugs.ulteo.com])

# Init automake
AM_INIT_AUTOMAKE([1.9 tar-pax])

# Checks for programs.
AC_PROG_INSTALL

AC_ARG_ENABLE(
    web,
    AC_HELP_STRING([--enable-web], [Install the web services (default=yes)]),
    ,
    [enable_web=yes])
if test x$enable_web != xno; then
    enable_web=yes
fi
AM_CONDITIONAL([WEB], [test x"$enable_web" = x"yes"])

AC_ARG_ENABLE(
    daemon,
    AC_HELP_STRING([--enable-daemon], [Install the chroot daemon (default=no)]),
    ,
    [enable_daemon=no])
if test x$enable_daemon != xno; then
    enable_daemon=yes
fi
AM_CONDITIONAL([DAEMON], [test x"$enable_daemon" = x"yes"])

# Allow use of already installed javascript libraries
AC_ARG_WITH([prototypedir],
    [AC_HELP_STRING([--with-prototypedir],
        [use a local installation of the Prototype javascript library])],
    ,
    [with_prototypedir=no])
if test x"$with_prototypedir" != xno; then
    if test -f "$with_prototypedir/prototype.js"; then
        PROTOTYPEDIR="$with_prototypedir"
        AC_SUBST(PROTOTYPEDIR)
        echo "Using $PROTOTYPEDIR for Prototype library."
    else
        AC_MSG_WARN([$with_prototypedir/prototype.js doesn't exist; using builtin Prototype library.])
        PROTOTYPEDIR=
    fi
fi
AM_CONDITIONAL(PROTOTYPE, [test -n "$PROTOTYPEDIR"])

AC_ARG_WITH([scriptaculousdir],
    [AC_HELP_STRING([--with-scriptaculousdir],
        [use a local installation of the Scriptaculous javascript library])],
    ,
    [with_scriptaculousdir=no])
if test x"$with_scriptaculousdir" != xno; then
    if test -f "$with_scriptaculousdir/scriptaculous.js"; then
        SCRIPTACULOUSDIR="$with_scriptaculousdir"
        AC_SUBST(SCRIPTACULOUSDIR)
        echo "Using $SCRIPTACULOUSDIR for Scriptaculous library."
    else
        AC_MSG_WARN([$with_scriptaculousdir/scriptaculous.js doesn't exist; using builtin Prototype library.])
        SCRIPTACULOUSDIR=
    fi
fi
AM_CONDITIONAL(SCRIPTACULOUS, [test -n "$SCRIPTACULOUSDIR"])


AC_CONFIG_FILES([
Makefile
daemon/Makefile
daemon/init/Makefile
daemon/log.d/Makefile
daemon/modules_fs.d/Makefile
daemon/functions.d/Makefile
scripts/Makefile
config/Makefile
examples/Makefile
web/webservices/Makefile
web/media/image/Makefile
web/media/script/Makefile
web/media/script/lib/prototype/Makefile
web/media/script/lib/scriptaculous/Makefile
web/media/script/lib/Makefile
web/media/style/Makefile
web/media/Makefile
web/applet/Makefile
web/includes/Makefile
web/classes/Makefile
web/Makefile
])
AC_OUTPUT

echo
echo "Configuration:"
echo "* web:    $enable_web"
echo "* daemon: $enable_daemon"


<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" 
	  "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">
<article xmlns:xi="http://www.w3.org/2001/XInclude">
  <articleinfo>
    <title>Ulteo Open Virtual Desktop</title>
    <subtitle>Installation</subtitle>
    <graphic fileref="img/ovd.png" align="center"/>

    <copyright>
      <year>2008</year>
      <year>2009</year>
      <year>2010</year>
      <holder>Ulteo SAS - <ulink url="http://www.ulteo.com" /></holder>
    </copyright>
  </articleinfo>

  <section id="pre">
    <title id="pre_title">Prerequisites</title>

    <para id="prerequisites">
      A minimal Open Virtual Desktop infrastructure requires one
      <emphasis role="strong">Session Manager</emphasis> and one
      <emphasis role="strong">Application Server</emphasis>.

      <itemizedlist>
	<listitem>
	  <para>
	    the Session Manager is a LAMP (Linux Apache MySQL
	    PHP) system and could be used in an exising LAMP server.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    the Application Server is a server where the desktop and
	    applications will be executed. It has to be a Ulteo OVD
	    <emphasis role="strong">dedicated server</emphasis>.
	  </para>
	</listitem>
      </itemizedlist>

      <important>
	<para>
	  In this document, we are using
	  <emphasis>sm.ulteo.com</emphasis> for the Session Manager
	  and <emphasis>aps.ulteo.com</emphasis> for Application
	  Server.
	</para>

	<para>
	  You need to set that names according to your own domain
	  names.
	</para>
      </important>

      <note>
	<para>
	  It is possible to install both Application Server and
	  Session Manager on the <emphasis role="strong">same machine</emphasis>.
	</para>
      </note>

    </para>

    <para>
      The servers used by Ulteo OVD need to be installed with <emphasis
      role="strong">Ubuntu 8.04.3 (Hardy Heron) Server for x86/32
      bits</emphasis> (it can be downloaded from <ulink
      url="http://releases.ubuntu.com/8.04/ubuntu-8.04.4-server-i386.iso">this
      link</ulink>).
    </para>

    <para>
      All operations need to be done as <emphasis>super
      user</emphasis>.
    </para>

    <itemizedlist>
      <listitem>
	<para>To log in as root:
	  <screen><![CDATA[$ sudo -s]]></screen>
	</para>
      </listitem>
    </itemizedlist>

    <section id="pre_mysql">
      <title id="sql_title">Installation of MySQL</title>
      <para id="mysql_install">
	If you don't have any available MySQL database, you have to
	install MySQL on your Session Manager.
      </para>
      <itemizedlist>
	<listitem>
	  <para>Install the <emphasis>mysql-server</emphasis> package:</para>
          <screen># apt-get install mysql-server</screen>
          <para>A password for <literal>root</literal> will be asked.</para>
        </listitem>
        <listitem>
	  <para id="mysql_db_create">
	    Now log in mysql and create a database:
	  <screen><![CDATA[
# mysql -u root -p
Enter password:
mysql> create database ulteo_sm;
 Query OK, 1 row affected (0.02 sec)
mysql> exit]]>
          </screen>
	</para>
        </listitem>
      </itemizedlist>
      <beginpage />
    </section>
  </section>

  <section id="sm">
    <title id="sm_title">Session Manager (sm.ulteo.com)</title>
    <para id="sm_definition">
      The Session Manager is the main server for your <emphasis>Ulteo
      Open Virtual Desktop infrastructure</emphasis>.  It will manage
      all your application servers through an administration web
      interface.
    </para>

  <section id="sm_install">
    <title>Installation</title>

    <itemizedlist>
      <listitem>
	<para>
	  Add the Ulteo repository to the repository list:
	</para>
        <screen>
	  <![CDATA[
# echo "deb http://archive.ulteo.com/ulteo/ovd 2.5 main" >> /etc/apt/sources.list
# apt-get update]]>
	</screen>
    <note>
	<para>
	  GPG errors given by the previous command will be fixed in the next
      installation steps. They won't prevent the installation to be
      successful.
	</para>
    </note>
    </listitem>

    <listitem>
    <para>
      Install the keyring package to validate the repository using gpg:
    </para>
    <screen>
	  <![CDATA[
# apt-get install ulteo-keyring
# apt-get update]]>
	</screen>
    </listitem>
      <listitem>
	<para>Install the <emphasis>ulteo-ovd-session-manager</emphasis> package:</para>
        <screen>
	  <![CDATA[
# apt-get install ulteo-ovd-session-manager]]>
	</screen>
      </listitem>

      <listitem>
	<para>
	  The installer asks for an admin login
	</para>
    	<para>
	  <inlinemediaobject>
	    <imageobject>
              <imagedata fileref="img/sm_install_admin_login.png"/>
	    </imageobject>
	    <textobject>
	      <phrase>Session Manager installation admin login</phrase>
	    </textobject>
	  </inlinemediaobject>
	</para>
	<beginpage />
      </listitem>

      <listitem>
	<para>
	  And a password:
	</para>
    	<para>
	  <inlinemediaobject>
	    <imageobject>
              <imagedata fileref="img/sm_install_admin_password.png"/>
	    </imageobject>
	    <textobject>
	      <phrase>Session Manager installation admin password</phrase>
	    </textobject>
	  </inlinemediaobject>
	</para>
      </listitem>

      <listitem>
	<para>
	  which has to be confirmed:
	</para>
    	<para>
	  <inlinemediaobject>
	    <imageobject>
              <imagedata fileref="img/sm_install_admin_confirm_password.png"/>
	    </imageobject>
	    <textobject>
	      <phrase>Session Manager installation admin password confirmation</phrase>
	    </textobject>
	  </inlinemediaobject>
	</para>
	<beginpage />
      </listitem>

      <listitem>
	<para>
	  Application servers are using an application system that will be the same for all your application servers:
	</para>
    	<para>
	  <inlinemediaobject>
	    <imageobject>
              <imagedata fileref="img/sm_install_chroot_location.png"/>
	    </imageobject>
	    <textobject>
	      <phrase>Session Manager installation application system archive</phrase>
	    </textobject>
	  </inlinemediaobject>
	</para>
	<para>
	If you don't have access to Internet, keep this field empty,
	we'll see later <link linkend="sm_chroot">how to
	install</link> it by hand.
	</para>
      </listitem>
    </itemizedlist>

    <para id="sm_install_browse">
      The server is now installed but not configured yet. You have to
      open <ulink url="http://sm.ulteo.com/sessionmanager" /> with a
      web browser.It should display this page:
    </para>

    <para id="sm_install_browse_pic">
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="img/sm_www_service_not_available.png"/>
	</imageobject>
	<textobject>
	  <phrase>Session Manager into a web browser</phrase>
	</textobject>
      </inlinemediaobject>
    </para>

    <section id="sm_chroot">
      <title>Setup the application system archive</title>

      <para>
	If you didn't specify an URL at the last question, you have to
	copy an application system archive into <emphasis
	role="strong">/usr/share/ulteo/sessionmanager/base.tar.gz</emphasis>.
      </para>

      <para>
	For instance, you can download an archive from <ulink
	url="http://www.ulteo.com/main/downloads/ulteo-ovd.php?suite=2.5" />
	from another computer which have access to Internet and copy
	it on a usb stick.  Then, you have to copy it on the Session
	Manager at
	<emphasis>/usr/share/ulteo/sessionmanager/base.tar.gz</emphasis>
      </para>
      <beginpage />
    </section>

  </section>

  <section id="sessionmanager_configuration">
    <title>Configuration</title>

    <para>
      The first step is to go to <ulink
      url="http://sm.ulteo.com/sessionmanager/admin" /> and
      autenticate yourself with the login and password you provided
      during the installation.
    </para>
    <para>
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="img/sm_www_admin_login.png"/>
	</imageobject>
	<textobject>
	  <phrase>Session Manager admin login</phrase>
	</textobject>
      </inlinemediaobject>
    </para>

    <para>
      For the first time you login, the system detect that is not well
      configured so you are redirected to a basic setup page which
      will save a default configuration.
    </para>
    <para>
      You have to set the MySQL configuration. For instance, if you
      install MySQL on the same host as described previously, here is
      the configuration:
    </para>
    
    <para>
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="img/sm_install_admin_config_init.png"/>
	</imageobject>
	<textobject>
	  <phrase>Session Manager admin init configuration</phrase>
	</textobject>
      </inlinemediaobject>
    </para>

    <para>
      Then, you should be redirected to the main page:
    </para>
    <para>
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="img/sm_admin_main.png"/>
	</imageobject>
	<textobject>
	  <phrase>Session Manager admin main page</phrase>
	</textobject>
      </inlinemediaobject>
    </para>

    <!--
    <simplesect>
      <title>Applications server settings</title>

      <para>
	Before begin to install an Application server, we just have to
	setup the authorized server list in order to your server won't
	be refused.
      </para>

      <para>
	So, go to <emphasis role="strong">Configuration</emphasis>
	then <emphasis role="strong">Server settings</emphasis>.
      </para>

      <para>
	In our example, the Application server named is <emphasis>aps.ulteo.com</emphasis>:
      </para>

      <para>
	<inlinemediaobject>
	  <imageobject>
	    <imagedata fileref="img/sm_admin_install_fqdn.png"/>
	  </imageobject>
	  <textobject>
	    <phrase>Session Manager configure authorized servers</phrase>
	  </textobject>
	</inlinemediaobject>
      </para>
    </simplesect>
    -->
<!--
    <para>
     For other specific configuration, please refer to the <emphasis
     role="strong">Administration Console documentation</emphasis>.
    </para>
-->
    <para>
      The session manager has no application server plugged yet.  You
      now have to <link linkend="aps">install one or more Application
      Servers</link>.
    </para>
    <beginpage />
  </section>


  </section>

  <section id="aps">
    <title id="aps_title">
      Application Server installation (aps.ulteo.com)
    </title>
    <itemizedlist>
      <listitem>
        <para>
	  Add the Ulteo repositoriy to the Ubuntu repository list:
        </para>
        <screen>
	  <![CDATA[
# echo "deb http://archive.ulteo.com/ulteo/ovd 2.5 main" >> /etc/apt/sources.list
# apt-get update]]>
        </screen>
      </listitem>
    <listitem>
    <para>
      Install the keyring package to validate the repository using gpg:
    </para>
    <screen>
	  <![CDATA[
# apt-get install ulteo-keyring
# apt-get update]]>
	</screen>
    <note>
	<para>
	  GPG errors given by the previous command will be fixed in the next
      installation steps. They won't prevent the installation to be
      successful.
	</para>
    </note>
    </listitem>
      <listitem>
        <para>
	  Install the package <emphasis>ulteo-ovd-application-server</emphasis>:
        </para>
        <screen>
	  <![CDATA[
# apt-get install ulteo-ovd-application-server]]>
	</screen>
      </listitem>

      <listitem>
        <para>
	  The first question is about the FQDN (Fully Qualified Domain
	  Name) hostname of the machine you are using as an
	  Application Server.  This <emphasis>FQDN</emphasis> is used
	  by the Session Manager server to manage Application Servers.
	  If the FQDN is not defined well, this Application Server
	  will never register on the Main server.  Here we are using
	  <emphasis>aps.ulteo.com</emphasis>.
	</para>

	<important>
	  <para>
	    If you are going to install an Application server on the
	    same machine as your Session Manager, it's adviced to use
	    <emphasis role="strong">127.0.0.1</emphasis> as FQDN.
	  </para>
	</important>

	<para>
	  <inlinemediaobject>
            <imageobject>
              <imagedata fileref="img/cm_install_fqdn.png"/>
            </imageobject>
            <textobject>
	      <phrase>debconf FQDN question</phrase>
            </textobject>
	  </inlinemediaobject>
        </para>
	<beginpage />
      </listitem>

      <listitem>
        <para>
	  The next question is about the URL/path where the session
	  manager can be accessed. Provide the URL that was used
	  previously (we use <ulink
	  url="http://sm.ulteo.com/sessionmanager" /> here for the
	  example, but of course, you have to set your own domain
	  name).
	</para>

	<important>
	  <para>
	    If you are going to install an Application server on the
	    same machine as your Session Manager, it's adviced to use
	    <emphasis role="strong"><ulink
	    url="http://127.0.0.1/sessionmanager" /></emphasis> as
	    URL.
	  </para>
	</important>

	<para>
          <inlinemediaobject>
            <imageobject>
              <imagedata fileref="img/cm_install_sm_url.png"/>
            </imageobject>
            <textobject>
              <phrase>debconf session manager base url question</phrase>
            </textobject>
          </inlinemediaobject>
        </para>
      </listitem> 
    </itemizedlist>

    <para>
      The configuration is now done.  The system is going to donwload
      and uncompress the application system archive from the Session
      Manager your registered.
    </para>
    <para>
      Once done, you just have to restart the service:
    </para>
    <screen>
      <![CDATA[
# /etc/init.d/ulteo-ovd restart]]>
    </screen>


    <section id="aps_manage_sm">
      <title>Configuration</title>
      <simplesect>
	<title>Register the server</title>
      <para>
      An Application server has been installed and is now
      ready. First, we have to register it, and switch it from
      <emphasis>maintenance</emphasis> mode to
      <emphasis>production</emphasis> mode.

    <itemizedlist>
      <listitem>
	<para>
	  Your server should appear in the <emphasis
	  role="strong">Unregistered server</emphasis> page.
	</para>

	<screenshot>
	  <screeninfo>Session Manager - server page</screeninfo>
	  <graphic fileref="img/sm_admin_server_unregistered.png"></graphic>
	</screenshot>

	<para>
	  If your server does not appear in the list, you might have
	  a DNS configuration issue, please report to the <emphasis
	  role="strong">FAQ</emphasis> to solve this issue.
	</para>
      </listitem>

      <listitem>
	<para>
	  If you want to use this server on your network, you have to
	  click on <emphasis>register</emphasis>.
<!--
	  The server is going to be add in the serveraccept add the server
	  in your environment and switch it to maintenance mode.
-->
	</para>
      </listitem>
      <listitem>
	<para>
	  Now, click on <emphasis>Switch to production</emphasis> to
	  switch it to Production mode.
	</para>
      </listitem>
    </itemizedlist>
    </para>
    </simplesect>

    <simplesect id="aps_redirection_name">
      <title>Set an redirection name</title>

      <para>
	The server <emphasis role="strong">redirection name</emphasis> is
	an option. If all your machines are in the same network, you
	don't have to change it.
      </para>

      <important>
	<para>
	  If you installed your Application server on the same machine
	  as your Session Manager and you follow our advices, you
	  setup <emphasis role="strong">127.0.0.1</emphasis> as server
	  name so you <emphasis role="strong">must</emphasis> define
	  an redirection name.
	</para>
      </important>

      <para id="redirectionname_explain">
	The <emphasis role="strong">redirection name</emphasis> is used
	to launch session. When you launch a session, you are
	redirected to an Application server using the redirection name as
	redirection. In some cases the default redirection name (the
	FQDN you gave at the ApS installation) is not valid. For
	instance, if you setup an private IP address and you want to
	connect from Internet.
      </para>

      <screenshot>
	<screeninfo>Session Manager - server redirection name</screeninfo>
	<graphic fileref="img/sm_admin_external_name.png"></graphic>
      </screenshot>
    </simplesect>

    </section>
    <beginpage />
  </section>

  <section id="publication">
    <title>Perform a "Publication"</title>
 
      <para>
	A publication is an association between a users group and an
	applications group. It's an authorization for a users group to
	launch the applications include in the group.
      </para>

      <para>
	By default, there is no users or applications group installed
	so you have to create it to launch sessions (it's not possible
	to launch session without application in the default
	configuration).
      </para>

      <para>
	To simplify the process, you can use the <emphasis
	role="strong">Publication wizard</emphasis> by going on
	<emphasis>Applications</emphasis> page.
      </para>

      <screenshot>
	<screeninfo>Session manager - publication page</screeninfo>
	<graphic fileref="img/sm_admin_publication.png"></graphic>
      </screenshot>

    <para>
      Go to the Publications page, select and follow the
      <emphasis>wizard</emphasis> steps.
    </para>
    <beginpage />
  </section>


  <section id="launch_session">
    <title>Launch a session</title>
    <important>
      <para>
        Client prerequisites:
         <itemizedlist>
           <listitem>
             Java 1.5/1.6 (Sun or OpenJDK)
           </listitem>
           <listitem>
             browser: Firefox 2+ or Internet Explorer 7+
           </listitem>
         </itemizedlist>
      </para>
    </important>
    <itemizedlist>
      <listitem>
	<para>
	  Back to <ulink url="http://sm.ulteo.com/sessionmanager/" />
	  with your browser, you should see a login page:
	</para>
	<para>
	  <inlinemediaobject>
            <imageobject>
	      <imagedata fileref="img/sm_login.png"/>
            </imageobject>
            <textobject>
	      <phrase>Session Manager login</phrase>
            </textobject>
	  </inlinemediaobject>
	</para>
	<beginpage />
      </listitem>


      <listitem>
	<para>
	  Once logged in, the session is launching:
	</para>
	<para>
	  <inlinemediaobject>
            <imageobject>
	      <imagedata fileref="img/cm_session_launching.png"/>
            </imageobject>
            <textobject>
	      <phrase>Session launching</phrase>
            </textobject>
	  </inlinemediaobject>
	</para>
	<beginpage />
      </listitem>

      <listitem>
	<para>
	  The session is launched and is ready to use with
	  applications that have been published for the user:
	</para>
	<para>
	  <inlinemediaobject>
            <imageobject>
	      <imagedata fileref="img/cm_session.png"/>
            </imageobject>
            <textobject>
	      <phrase>Session launched</phrase>
            </textobject>
	  </inlinemediaobject>
	</para>
      </listitem>
    </itemizedlist> 
  </section>
</article>

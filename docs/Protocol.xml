<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" 
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">
<article>
  <articleinfo>
    <title>Ulteo Open Virtual Desktop - Protocol Description</title>
    <graphic fileref="img/ovd.png" align="center"/>

    <copyright>
      <year>2008</year>
      <year>2009</year>
      <holder>Ulteo SAS</holder>
    </copyright>
  </articleinfo>

  <para>
    The purpose of this documentation is to describe the protocols
    used by <emphasis>Ulteo Open Virtual Desktop</emphasis>.
  </para>

  <section id="used_proto_list">
    <title>List of Protocols used</title>
    
    <section id="proto_http">
      <title>Hyper Text Transfert Protocol (HTTP)</title>

      <para>
	The base communication protocol used is HTTP because Ulteo is a 
	Web based solution.  But we also use HTTP for the
	communication between servers: Session Manager to Application
	Server and vice versa.  This protocol runs over TCP on the port
	80.  We are not using HTTPS (443) at the moment.
      </para>

      <para>
	The Administration Console is web-based too.
      </para>

      <para><ulink url="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP on Wikipedia</ulink></para>
    </section>

    <section id="proto_rfb">
      <title>Remote Frame Buffer (RFB)</title>

      <para>
	RFB is the protocol used to display the remote desktop and
	applications within the Web broswer.  This protocol is used by
	VNC.  VNC runs over TCP too.  A VNC server runs one instance by
	desktop so one port for each display.  The classic port used
	by VNC is 5900.
      </para>

      <para>
	For Ulteo Open Virtual Desktop, we are using ports between 5900
	and 6000.
      </para>

      <para><ulink url="http://en.wikipedia.org/wiki/RFB_protocol">RFB on Wikipedia</ulink></para>

    </section>

    <section id="proto_ssh">
      <title>Secure Shell (SSH)</title>

      <para>
	SSH is a protocol used to access a machine securely over a network.  SSH
	uses encryption to make sure that no one on the network can
	decrypt what the user does.
      </para>

      <para>
	We are using SSH to tunnel the RFB stream because RFB is not encprypted.
      </para>


      <para><ulink url="http://en.wikipedia.org/wiki/Secure_Shell">SSH on Wikipedia</ulink></para>
    </section>

    <section id="proto_rdp">
      <title>Remote Desktop Protocol (RDP)</title>

      <para>
	RDP is the protocol used by <trademark
	class="registered">Microsoft Corp.</trademark> to display the remote
	desktop for their <trademark>Terminal Services</trademark>
	software.
      </para>

      <para>
	RDP is used by Ulteo Open Virtual Desktop to display
	<trademark>Windows</trademark> applications.
      </para>

      <para><ulink url="http://en.wikipedia.org/wiki/Remote_Desktop_Protocol">RDP on Wikipedia</ulink></para>
    </section>
  </section>


  <section id="server_comm">
    <title>Server Communication</title>
    <para>
      Servers communicate by using HTTP webservices.
    </para>

    <para>
      The Session Manager identifies an Application server using its
      Fully Qualified Domain Name (FQDN).
    </para>

    <para>
      Applications Servers only answer to the Session Manager for which
      the address is stored in a configuration file.
      (<emphasis>SESSION_MANAGER_URL</emphasis>).
    </para>

    <section id="security">
      <title>Security</title>
      <para>
	At the moment, the server are authenticated using the DNS resolution system.
      </para>

      <para>
	When an Application server sends a status, it sends an extra
	argument named <emphasis>fqdn</emphasis>.  The Session Manager
	performs 2 authentication tests and 1 authorization.

	<itemizedlist>
	  <listitem><para><emphasis role="strong">fqdn
	  resoltuion:</emphasis> resolves the fqdn to get an ip address
	  and tests if it matches the remote server ip
	  ($SERVER['REMOTE_ADDR'] in php).  Authentication directly
	  depends on that match</para></listitem>

	  <listitem><para><emphasis role="strong">reverse
	  resolution:</emphasis> resolves the server ip address and tests
	  if it matches the fqdn argument. Authentication directly
	  depends on that match. This test can be disabled in the
	  administration console using <emphasis>Disable fqdn
	  check</emphasis></para></listitem>

	  <listitem><para><emphasis
			      role="strong">authorisation:</emphasis> tests the match of the fqdn
	  with one of the <emphasis>Authorized fqdn</emphasis> defined
	  in the admin console.</para></listitem>

	</itemizedlist>
      </para>
    </section>

    <section id="windows_servers">
      <title>Windows servers</title>
      <para>
	The Windows agent is using an embeded HTTP server instead of using
	Apache (as on Linux servers) or <trademark>IIS</trademark> which is often installed by
	default on <trademark>Windows Server 2003</trademark>.
      </para>

      <para>
	As <trademark>IIS</trademark> is often installed, the
	Windows agent doesn't use the standart HTTP port but the
	<emphasis role="strong">8082</emphasis> port. Another port can be
	set in the agent configuration file.
      </para>

    </section>

    <section id="http_code">
      <title>HTTP return codes</title>
      <para>
	Webservices are using the standard HTTP return codes to know if the
	request succeeded.
      </para>

      <itemizedlist>
	<listitem>
	  <para><emphasis role="strong">200 OK :</emphasis>
	  request succeeded</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">400 Bad Request :</emphasis>
	  request argument no valid</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">401 Unauthorized :</emphasis>
	  From SM to ApS: ApS detects that the remote address is not its
	  SM. From ApS to SM: ApS is not registered yet or has invalid
	  authentication.</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">500 Internal Server Error :</emphasis>
	  Either a bug was detected on the system or the system is
	  broken.</para>
	</listitem>
      </itemizedlist>
    </section>

    <section id="sm_webservices">
      <title>Session Manager webservices</title>

      <para>
	The webservices used for the servers communication are in
	<emphasis>/webservices</emphasis>.

      </para>

      <simplesect>
	<title>server_status.php</title>

	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem><para>fqdn
	      </para></listitem>
	      <listitem><para>
		status: ready/down/broken
	      </para></listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> GET</para>
	  </listitem>
	</itemizedlist>	  

	<para>
	  An application server sends his status at startup, when it stops or
	  when an important error occured.  That's the way the system
	  can know when an offline server is online again or when
	  a server needs to be registred.
	</para>
      </simplesect>

      <simplesect>
	<title>server_monitoring.php</title>

	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> POST</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem><para>fqdn
	      </para></listitem>
	      <listitem><para>
		xml: the monitoring XML file
	      </para></listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> nothing</para>
	  </listitem>
	</itemizedlist>	  

	<para>
	  Application servers send periodically their system
	  information to that the status of each
	  server is known. This is used for the session load balancing for
	  instance.
	</para>
	<para>
	  The monitoring contains the CPU and RAM load. But also
	  running applications for each sessions.
	</para>
      </simplesect>


      <simplesect>
	<title>session_invite.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>fqdn</para>
	      </listitem>
	      <listitem>
		<para>session: session id</para>
	      </listitem>
	      <listitem>
		<para>email: the email address to send the invitation</para>
	      </listitem>
	      <listitem>
		<para>mode: active|passive</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> the token of this share in XML content</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Application servers send a request when a user want create
	  invite someone.
	</para>
      </simplesect>


      <simplesect>
	<title>session_status.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>fqdn</para>
	      </listitem>
	      <listitem>
		<para>session: session id</para>
	      </listitem>
	      <listitem>
		<para>status: numerical status</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> nothing</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Application servers send, for each session, their status
	  each time it changes.
	</para>
      </simplesect>




      <simplesect>
	<title>session_token.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>fqdn</para>
	      </listitem>
	      <listitem>
		<para>token: a random string</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> session information as XML</para>
	  </listitem>
	</itemizedlist>

	<para>
	  When a user is launching a session, he is redirected
	  with a token to an Application Server. To verify the user
	  identity and get the session information, the Application
	  Server sending this token to to the Session Manager. If it's valid,
	  it gets information as XML content.
	</para>
      </simplesect>




      <simplesect>
	<title>icons.php</title>

	<para><emphasis role="strong">Used for Windows applications</emphasis></para>	
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>fqdn</para>
	      </listitem>
	      <listitem>
		<para>id: an application id</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> icon image in PNG</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Gets the icon for an application so it can display it
	  on the user desktop. The application server uses a cache
	  system so an application icon is only asked once by a server.
	</para>
      </simplesect>

      <simplesect>
	<title>app_desktopfile.php</title>

	<para><emphasis role="strong">Used for Windows applications</emphasis></para>	
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>fqdn</para>
	      </listitem>
	      <listitem>
		<para>desktopfile: a file path</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> application informations as XML content</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Gets the application information from the desktopfile
	  argument to create the application shortcut
	  on the user's desktop.
	</para>
      </simplesect>

    </section>


    <section id="aps_webservices">
      <title>Application Server webservices</title>
      
      <para>
	The webservices used for servers communication are in
	<emphasis>/webservices</emphasis>.
      </para>

      <simplesect>
	<title>server_status.php</title>

	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> No</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> ready/down/broken</para>
	  </listitem>
	</itemizedlist>	  

	<para>
	  The Session Manager asks for the server status periodically to
	  update its status, and detect down or broken states.
	</para>
      </simplesect>


      <simplesect>
	<title>session_status.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>session: a session id</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> numerical session status</para>
	  </listitem>
	</itemizedlist>

	<para>
	  The Session Manager asks for each session status periodically
	  to detect servers/sessions craches.
	</para>

      </simplesect>


      <simplesect>
	<title>server_monotoring.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> No</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> monitoring as XML content</para>
	  </listitem>
	</itemizedlist>
	<para>
	  Session Manager asks for the server monitoring when it
	  detects too old cache information.
	</para>
      </simplesect>


      <simplesect>
	<title>applications.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> No</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> applications list as XML content</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Gets installed applications on the system.
	</para>
      </simplesect>


      <simplesect>
	<title>kill_session.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>session: a session id</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> nothing</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Force a specific session to exit without notifying the user.
	</para>
      </simplesect>


      <simplesect>
	<title>server_version.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> No</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> version as plain/text content</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Get the server version. On Windows, gets the Windows long
	  version. On Linux, get the content of <emphasis>/etc/issue</emphasis>.
	</para>

      </simplesect>


      <simplesect>
	<title>server_type.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> No</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> windows/linux</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Gets the server type.
	</para>
      </simplesect>


      <simplesect>
	<title>icon.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>path: a file path</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> a PNG image</para>
	  </listitem>
	</itemizedlist>

	<para>
	  Extracts the icon associated with an application.
	</para>
      </simplesect>


      <simplesect>
	<title>apt-get.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis>
	    <itemizedlist>
	      <listitem>
		<para>path: request/status/show</para>
	      </listitem>
	      <listitem>
		<para>request: an apt-get request</para>
	      </listitem>
	      <listitem>
		<para>job: a job id</para>
	      </listitem>
	      <listitem>
		<para>shows: status/stderr/stdout</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> depends on action type
	    <itemizedlist>
	      <listitem><para>
		<emphasis>request: </emphasis> job id
	      </para></listitem>

	      <listitem><para>
		<emphasis>show: </emphasis> plain/text content
	      </para></listitem>
	      <listitem><para>
		<emphasis>job: </emphasis> a job id
	      </para></listitem>
	      <listitem><para>
		<emphasis>status: </emphasis> -3/-2/-1/0/1/2
	      </para></listitem>
	    </itemizedlist>
	    </para>
	  </listitem>
	</itemizedlist>

	<para>
	  Used to install/remove applications.
	</para>
	<para>
	  Gets job id from action request.
	</para>
      </simplesect>

    </section>
  </section>


  <section id="desktop_session">
    <title>Desktop Session</title>
    <!--
    <para> startsession.php: HTTP 302 -> redirection on the APS
    external name with a token.  </para> <para> ApS connect to the SM
    and use the token.  </para> <para> Client have to call
    /startsession.php to init the session then the session is
    initialize and start (a call to applet.php give the applet
    configuration).  </para>
    -->

    <para>Here is the session launching process:</para>
    <para>
      
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="img/session.png"/>
	</imageobject>
      </inlinemediaobject>
    </para>


    <section id="desktop_comm">
      <title>Client/Server communication</title>

      <para>
	Once the client is redirected to the ApS, it only requires this
	server, not the SM, excepted for session sharing as described below.
      </para>

      <para>
	The webservices used in the root directory
	(<emphasis>/</emphasis>) of the application server.
      </para>

      <para>
	The session display is encapsulated in a SSH tunnel but
	webservices are also used to communicate. For instance, for
	printing.
      </para>

      <simplesect>
	<title>access.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> NO </para>
	  </listitem>

	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> the
	    session access as XML content or HTML depending if the
	    <emphasis>html</emphasis> is set.</para>
	  </listitem>
	</itemizedlist>

	<para>
	  When <emphasis>whatsup</emphasis> give a session ready, the
	  client has to call this one to get all the access to join
	  the session: SSH port/login/password, VNC port/password ...
	</para>
      </simplesect>

      <simplesect>
	<title>invite.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> POST</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> 
	    <itemizedlist>
	      <listitem>
		<para>email: the email address to send the invitation</para>
	      </listitem>
	      <listitem>
		<para>mode: active|passive</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>

	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> OK</para>
	  </listitem>
	</itemizedlist>

	<para>
	  <emphasis>invite.php</emphasis> is call when the session
	  owner wants to invite someone. The Application server ask to
	  the Session Manager to create the invitation and send the
	  email.
	</para>

	<para>
	  The <emphasis role="strong">passive</emphasis> mode is a
	  view of the session where you cannot move the mouse cursor
	  or type keys on your keyboard. It's a view only mode.
	</para>
      </simplesect>


      <simplesect>
	<title>exit.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> ANY</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> NO</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> bye</para>
	  </listitem>
	</itemizedlist>

	<para>
	  This webservice can be called when users close the session
	  window to force the session to exit instead of waiting the
	  timeout trigger.
	</para>

	<para>
	  This is useful on session sharing for instance to be sure
	  that when the client exits, all users sharing the session cannot
      still access it.
	</para>
      </simplesect>


      <simplesect>
	<title>print.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> 
	    <itemizedlist>
	      <listitem>
		<para>timestamp: a time refered to the pdf file time to download</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>

	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> a PDF file</para>
	  </listitem>
	</itemizedlist>

	<para>
	  This webserice is the way to transport the print jobs from
	  the session to the client.
	</para>

	<para>
	  On ApS servers, there is a PDF printer that spools files in the
	  session directory. When there is a new file,
	  <emphasis>whatsup</emphasis> detects it, extracts the
	  timestamp and alerts the client. Then the client has just to
	  request a print with the timestamp to get the print job and
	  use a mean to print localy (printing applet).
	</para>
      </simplesect>


      <simplesect>
	<title>start.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET|POST</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> 
	    <itemizedlist>
	      <listitem>
		<para>height: the desired height of the session</para>
	      </listitem>
	      <listitem>
		<para>width: the desired width of the session</para>
	      </listitem>
	    </itemizedlist>
	    </para>
	  </listitem>

	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> nothing</para>
	  </listitem>
	</itemizedlist>

	<para>
	  This webservice is called when <emphasis>whatsup</emphasis>
	  returned 0 as session status. Startsession sets the session
	  status to 1.
	</para>
      </simplesect>


      <simplesect>
	<title>whatsup.php</title>
	
	<itemizedlist>
	  <listitem>
	    <para><emphasis role="strong">method:</emphasis> GET</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">arguments:</emphasis> NO</para>
	  </listitem>
	  <listitem>
	    <para><emphasis role="strong">returns:</emphasis> session
	    informations as XML content</para>
	  </listitem>
	</itemizedlist>

	<para>
	  The webservice has several uses. First of all, it's used to
	  know that the user is still connected (a kind of ping
	  timeout process).  Secondly, it allows the client to know
	  session status changes. Finally, it is used to know when a
	  new pdf file is ready for download and print.
	</para>

	<para>
	  The client calls this webservice every 10 seconds
	  maximum.
	</para>
      </simplesect>
    </section>

    <section id="startsession">
      <title>Startsession</title>

      <para>
	The main page of the Session Manager is not a needed step to
	launch a session, it's just an interface to call <emphasis
	role="strong">startsession.php</emphasis>.
      </para>

      <para>
	The goal of this section is to desbribe the API of
	startsession.php in order to call it using an external HTML
	file.
      </para>

      <itemizedlist>
	<listitem>
	  <para><emphasis role="strong">method:</emphasis> POST</para>
	</listitem>
	<listitem>
	  <para><emphasis role="strong">needed arguments:</emphasis> 
	  <itemizedlist>
	    <listitem>
	      <para>login</para>
	    </listitem>
	    <listitem>
	      <para>password</para>
	    </listitem>
	  </itemizedlist>
	  </para>
	</listitem>
	<listitem>
	  <para><emphasis role="strong">optionnal arguments:</emphasis> 
	  <itemizedlist>
	    <listitem>
	      <para>timezone:
	        US/Eastern|Europe/London|Asia/Tokyo... Desired timezone for the session.
	        Default is server timezone
	      </para>
	    </listitem>
	    <listitem>
	      <para>client: browser|strict.
	      Define the client type. Default is strict
	      </para>
	    </listitem>
	    <listitem>
	      <para>desktop_quality: [1-9]</para>
	    </listitem>
	    <listitem>
	      <para>desktop_locale:
	      fr_FR.UTF-8|en_GB.UTF-8|en_US.UTF-8... Desired locale
	      for the session (in Unix format)</para>
	    </listitem>
	    <listitem>
	      <para>desktop_timeout: a number of second</para>
	    </listitem>
	    <listitem>
	      <para>start_app:
	      /usr/bin/soffice-writer|/usr/bin/firefox... An
	      application path to launch at session start</para>
	    </listitem>
	    <listitem>
	      <para>debug: 0|1</para>
	    </listitem>
	  </itemizedlist>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <emphasis role="strong">return:</emphasis>
	    <itemizedlist>
	    <listitem>
	      <para>if fails: a HTML message</para>
	    </listitem>
	    <listitem>
	      <para>if success: a HTTP redirection (302) to an
	      application server</para>
	    </listitem>
	  </itemizedlist>
	  </para>
	</listitem>
      </itemizedlist>

      <para>
	Here is a example of a basic HTML page which start a
	session:
	<screen>
	  <![CDATA[
<html>
  <body>
<form action="http://sm.ulteo.com/sessionmanager/startsession.php" method="post">
 <input type="hidden" name="client" value="browser" />

 Login: 
 <input type="text" name="login" value="" />
 <br/>

 Password: 
 <input type="password" name="password" value="" />
 <br/>

 Language: 
 <select name="desktop_locale">
  <option value="en_GB.UTF-8">English</option>
  <option value="fr_FR.UTF-8">French</option>
 </select>
 <br/>

 <input type="submit" value="Launch" />

</form>
 </body>
</html>]]>
	</screen>
      </para>


    </section>
  </section>


  <section id="ids_matching">
    <title>Numerical ID matching</title>

    <section id="id_session_status">
      <title>Session status</title>
      
      <para>
	The status sent by webservices and used by both systems (Session
	Manager and Application server) are integer figures.
      </para>

      <itemizedlist>
	<listitem>
	  <para><emphasis role="strong">-1:</emphasis> session to create</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">0:</emphasis> session created</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">1:</emphasis> session to start</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">22:</emphasis> session is starting</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">2:</emphasis> session ready</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">3:</emphasis> session to destroy</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">4:</emphasis> unknown
	  session/session destroyed</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">9:</emphasis> session to suspend</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">10:</emphasis> session suspended</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">11:</emphasis> session to restore</para>
	</listitem>
      </itemizedlist>
    </section>


    <section id="id_jobs_status">
      <title>Jobs status</title>
      
      <para>
	When installing/removing applications using the
	<emphasis>apt-get</emphasis> webservice, the Administration
	console requests the ApS server to return the status of the job.
      </para>

      <itemizedlist>
	<listitem>
	  <para><emphasis role="strong">-3:</emphasis> server error</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">-2:</emphasis> job made an
	  error, system can switch in broken mode</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">-1:</emphasis> job id not exist</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">0:</emphasis> job is spooling</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">1:</emphasis> job in progress</para>
	</listitem>

	<listitem>
	  <para><emphasis role="strong">2:</emphasis> job finished</para>
	</listitem>


      </itemizedlist>
    </section>
  </section>

</article>

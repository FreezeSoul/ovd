<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
                 "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"> 

<article xmlns:xi="http://www.w3.org/2001/XInclude">

  <articleinfo>
    <title>Ulteo Open Virtual Desktop</title>
    <subtitle>Installation from sources</subtitle>
    <graphic fileref="img/ovd.png" align="center"/>

    <copyright>
      <year>2009</year>
      <year>2010</year>
      <holder>Ulteo SAS - <ulink url="http://www.ulteo.com" /></holder>
    </copyright>
  </articleinfo>


  <section>
    <xi:include href="Installation.xml" xpointer="pre_title" />
    <xi:include href="Installation.xml" xpointer="prerequisites" />

    <section>
      <xi:include href="common.xml" xpointer="sql_title" />
      <xi:include href="common.xml" xpointer="mysql_install" />
      <xi:include href="common.xml" xpointer="mysql_db_create" />
 
      <beginpage />
    </section>
  </section>


  <section>
    <xi:include href="Installation.xml" xpointer="sm_title" />
    <xi:include href="Installation.xml" xpointer="sm_definition" />

    <para>
      All operations need to be done as
      <emphasis>superuser</emphasis> (root).
    </para>

    <section>
      <title>Java Applet</title>
    </section>
     
     <section>
    <title>Session Manager package</title>
   <section>
      <title>Dependencies</title>

      <itemizedlist>
        <listitem>
	  <para>
	    <emphasis role="strong">Autotools: </emphasis>autoconf,
	    intltool, make.
	  </para>
        </listitem>
        <listitem>
	  <para>
	    <emphasis role="strong">PHP 5</emphasis> with modules curl,
	    ldap, mysql, and gettext.
	  </para>
        </listitem>
       <listitem>
	  <para>
	    <emphasis role="strong">Apache 2</emphasis> with php
	    module enable.
	  </para>
        </listitem>
       <listitem>
	  <para>
	    <emphasis role="strong">Java developper kit</emphasis> with ant, keytool, jdk >=1.5
	  </para>
        </listitem>

      </itemizedlist>
      <beginpage />
    </section>

   <section id="build_applet">
     <title>Java applet compilation</title>

     <para>
       Extract the ovd applet tarball and enter in the directory
     </para>
     <screen>
       <![CDATA[
$ tar xfz ovd-applets.tar.gz
$ cd ovd-applets/]]>
     </screen>

     <simplesect>
       <title>Generate a certificate</title>

       <itemizedlist>
         <listitem>
	   <para>
	    Create a working directory
	  </para>
	  <screen>
	    <![CDATA[
$ mkdir certificate
$ cd  certificate]]>
	  </screen>
	 </listitem>

         <listitem>
	   <para>
	     Set the options
	   </para>
	   <screen>
	     <![CDATA[
$ export PASSWD="123546"
$ export DNAME="cn=myname, ou=Ulteo, o=Ulteo, c=EN"
$ export ALIAS="ulteo"
$ export KEYSTORE=keystore
$ export VALIDITY=180]]>
	   </screen>
	 </listitem>

         <listitem>
	   <para>
	     Build the certificate
	   </para>
	   <screen>
	     <![CDATA[
$ keytool -genkeypair -dname "$DNAME" -alias "$ALIAS" -keypass "$PASSWD" -storepass "$PASSWD" -keystore "$KEYSTORE" -validity "$VALIDITY"]]>
	   </screen>
	 </listitem>

        <listitem>
	   <para>
	     Self sign the certificate
	   </para>
	   <screen>
	     <![CDATA[
$ keytool -selfcert -alias "$ALIAS" -keystore "$KEYSTORE" -keypass "$PASSWD" -storepass "$PASSWD"]]>
	   </screen>
	 </listitem>

        <listitem>
	   <para>
             Back to the parent directory (the applet source one)
	   </para>
	   <screen>
	     <![CDATA[
$ cd ..]]>
	   </screen>
	 </listitem>
       </itemizedlist>
     </simplesect>

     
     <simplesect>
       <title>Compilation</title>

       <itemizedlist>
	 <listitem>
           <para>
             Set the java development environnement.
             For instance, if you are using Sun java 5:
           </para>
            <screen>
	     <![CDATA[
$ export JAVA_BINDIR=/usr/lib/jvm/java-1.5.0-sun-1.5.0/bin
$ export JAVA_ROOT=/usr/lib/jvm/java-1.5.0-sun-1.5.0
$ export JAVA_HOME=/usr/lib/jvm/java-1.5.0-sun-1.5.0]]>
	   </screen>
	 </listitem>

	 <listitem>
           <para>
            Compile
           </para>
            <screen>
	     <![CDATA[
$ ant sign -Dprefix=/usr -Dbuild.cert=certificate/]]></screen>
	 </listitem>

<!--

Hack OpenSuse, modify the build.xml:

Change 
    <property name="datadir"     location="${prefix}/share" />
by
    <property name="datadir"     location="/share" />

Change
    <property name="destdir"     location="" />  <- mettre /usr/local/share/ 
by
    <property name="destdir"     location="/usr/local/share/" />
-->

	 <listitem>
           <para>
             Install
           </para>
            <screen>
	     <![CDATA[
# ant install]]>
	   </screen>
	 </listitem>
       </itemizedlist>
     </simplesect>
   </section>

   <section>
      <title>Installation</title>

      <itemizedlist>
	<listitem>
	  <para>
	    Download the Ulteo Open Virtual Desktop tarball from
	    <ulink url="http://www.ulteo.com/home/ovdi/openvirtualdesktop/download" />
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Uncompress the tarball and enter into the Session Manager
	    directory
	  </para>
	  <screen>
	    <![CDATA[
$ tar xzf ulteo-ovd.tar.gz
$ cd ulteo-ovd
$ tar xzf sessionmanager.tar.gz
$ cd sessionmanager]]>
	  </screen>
	</listitem>

	<listitem>
	  <para>
	    Install the system
	  </para>
	  <screen>
	    <![CDATA[
./configure && make && make install]]>
	  </screen>
	</listitem>
	<listitem>
	  <para>
	    Add <filename>/usr/local/bin</filename> to the PATH
	  </para>
	  <screen>
	    <![CDATA[
export PATH=$PATH:/usr/local/bin]]>
	  </screen>
	</listitem>

	<xi:include href="Installation_RedHat.xml" xpointer="sm_install_sm_config" />

	<listitem>
	  <para>
	    Restart apache
	  </para>
	  <screen>
	    <![CDATA[
apache2ctl restart]]>
	  </screen>
        </listitem>
      </itemizedlist>

    <xi:include href="Installation.xml" xpointer="sm_install_browse" />
    <xi:include href="Installation.xml" xpointer="sm_install_browse_pic" />

	<para>
	If you get an empty page and see an error about mb_internal_encoding() in the Apache log,
comment line:<screen>
	    <![CDATA[
mb_internal_encoding('UTF-8');]]></screen>
in /usr/local/share/ulteo/sessionmanager/includes/core.inc.php and /usr/local/share/ulteo/sessionmanager/includes/core-minimal.inc.php.
	</para>
    </section>

  <xi:include href="Installation.xml" xpointer="sessionmanager_configuration" />
</section>
</section>

<section id="aps">
  <xi:include href="Installation.xml" xpointer="aps_title" />

  <para>
    All operations need to be done as <emphasis>superuser</emphasis>
    (root).
  </para>
  

  

  <section>
    <title>Dependencies</title>

    <itemizedlist>
      <listitem>
	<para>
	  <emphasis role="strong">Autotools: </emphasis>autoconf
	  intltool make
	</para>
      </listitem>
      <listitem>
	<para>
	  <emphasis role="strong">PHP 5</emphasis> with modules curl
	  imagick.
	</para>
      </listitem>
      <listitem>
	<para>
	  <emphasis role="strong">Apache 2</emphasis> with php
	  module enable.
	</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Installation</title>

    <important>
      <para>
        If you are not installing on the same server as a already
        existing one, you have to build the applets. To build the
        applet, please follow
        the <link linkend="build_applet">instructions on the Session
        Manager installation</link>.
      </para>
    </important>

    <itemizedlist>
      <listitem>
	  <para>
	    Download the Ulteo Open Virtual Desktop tarball from
	    <ulink url="http://www.ulteo.com/home/ovdi/openvirtualdesktop/download" />
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Uncompress the tarball and enter into the Application
	    server directory
	    <ulink url="http://www.ulteo.com/home/ovdi/openvirtualdesktop/download" />
	  </para>
	  <screen>
	    <![CDATA[
$ tar xzf ulteo-ovd.tar.gz
$ cd ulteo-ovd
$ tar xzf applciationserver.tar.gz
$ cd applicationserver]]>
	  </screen>
	</listitem>

	<listitem>
	  <para>
	    Install the system
	  </para>
	  <screen>
	    <![CDATA[
# ./configure && make && make install]]>
	  </screen>
	</listitem>
	<listitem>
	  <para>
	    Add <filename>/usr/local/bin</filename> to the PATH
	  </para>
	  <screen>
	    <![CDATA[
export PATH=$PATH:/usr/local/bin]]>
	  </screen>
	</listitem>

	<xi:include href="Installation_RedHat.xml" xpointer="aps_install_aps_chroot_install" />

	<listitem>
	  <para>
	    Then start the OVD daemon in the chroot:
	  </para>
	  <screen>
	    <![CDATA[
chroot /opt /etc/init.d/ulteo-ovdd start]]>
	  </screen>
        </listitem>
      </itemizedlist>
      <beginpage />
    </section>
    <xi:include href="Installation.xml" xpointer="aps_manage_sm" />
</section>

<xi:include href="Installation.xml" xpointer="publication" />
<xi:include href="Installation.xml" xpointer="launch_session" />

</article>

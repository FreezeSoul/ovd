=== modified file 'rdesktop.c'
--- rdesktop.c	2009-12-03 09:06:11 +0000
+++ rdesktop.c	2010-01-04 14:00:41 +0000
@@ -534,8 +534,10 @@
 				break;
 
 			case 13: //--iconify-by-display
-				g_icon = ICONIFY;
-				arg = optarg;
+				/*g_icon = ICONIFY;
+				arg = optarg;*/
+				printf("The option '--iconify-by-display' is disabled");
+				return 1;
 				break;
 
 			case 14: //--uniconify-by-display

=== modified file 'xdisplay.c'
--- xdisplay.c	2009-10-07 10:03:25 +0000
+++ xdisplay.c	2010-01-04 14:21:08 +0000
@@ -684,9 +684,10 @@
 	RD_BOOL maximized_vert, maximized_horz, hidden;
 
 	maximized_vert = maximized_horz = hidden = False;
-
-	if (xdisplay_get_property_value(dis, w, "_NET_WM_STATE", 64, &nitems_return, &prop_return, 0) < 0)
-		return SEAMLESSRDP_NORMAL;
+	if (xdisplay_get_property_value(dis, w, "_NET_WM_STATE", 64, &nitems_return, &prop_return, 0) < 0) {
+		if (xdisplay_get_property_value(dis, w, "WM_STATE", 64, &nitems_return, &prop_return, 0) < 0)
+			return SEAMLESSRDP_NORMAL;
+	}
 
 	return_words = (uint32 *) prop_return;
 
@@ -1085,7 +1086,7 @@
 	if(dis == NULL)
 		return False;
 
-	for(sw = xwindow_first; sw != NULL; sw = sw->next)
+	for(sw = xwindow_first; sw; sw = sw->next)
 	{
 		if(sw->sa->dis == dis)
 		{
@@ -1108,14 +1109,22 @@
 	if(dis == NULL)
 		return False;
 
-	for(sw = xwindow_first; sw != NULL; sw = sw->next)
+	for(sw = xwindow_first; sw; sw = sw->next)
 	{
-		if(sw->sa->dis == dis)
-		{
-			XMapWindow(dis->display, sw->wnd);
-			sw->state = xdisplay_ewmh_get_window_state(dis, sw->wnd);
-			seamless_send_state(sw->id, sw->state, 0);
-		}
+		if(sw->sa->dis == dis) {
+#ifdef WITH_DEBUG
+			DEBUG(("Uniconify wnd %s on display %s\n", sw->sa->cmdline, sw->sa->dis->name));
+#endif
+			XMapWindow(sw->sa->dis->display, sw->wnd);
+		}
+		else {
+#ifdef WITH_DEBUG
+			DEBUG(("Iconify wnd %s on display %s\n", sw->sa->cmdline, sw->sa->dis->name));
+#endif
+			XIconifyWindow(sw->sa->dis->display, sw->wnd, DefaultScreen(sw->sa->dis->display));
+		}
+		sw->state = xdisplay_ewmh_get_window_state(sw->sa->dis, sw->wnd);
+		seamless_send_state(sw->id, sw->state, 0);
 	}
 	return True;
 }
@@ -1131,7 +1140,7 @@
 	if(dis == NULL)
 		return False;
 
-	for(sw = xwindow_first; sw != NULL; sw = next)
+	for(sw = xwindow_first; sw; sw = next)
 	{
 		next = sw->next;
 		if(sw->sa->dis == dis)


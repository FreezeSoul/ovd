#!/bin/sh

debconf-get-selections | grep -e "^ulteo-ovd" -e "^mysql-server" | chroot /target debconf-set-selections
chroot /target apt-cdrom add

apt_install_direct=/var/lib/ubiquity/apt-install-direct
is_apt_install_direct=[ -f $apt_install_direct ]
test $is_apt_install_direct || touch $apt_install_direct
cp /usr/lib/ubiquity/ovd-setup/initctl_hook /target/sbin/initctl
apt-install ulteo-ovd-easy-install
test $is_apt_install_direct || rm $apt_install_direct

# change /etc/issue
unset LANG
eth=$(ifconfig | grep ^eth | head -n 1 | cut -d' ' -f1)
if [ -n "$eth" ]; then
    ip=$(ifconfig $eth | sed -rn '/inet addr/ {s/.*addr:(.*)  Bcast.*/\1/;p}')
    [ -n "$ip" ] && sed -i "s/-------/${ip}/" /target/etc/issue
fi

exit 0
